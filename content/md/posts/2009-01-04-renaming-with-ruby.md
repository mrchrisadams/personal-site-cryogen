

{:author "admin", :title "Renaming stuff with Ruby", :date "2009-01-04 10:49:25", :publish-date "Sun, 04 Jan 2009 10:49:25 +0000"}



<!-- content below -->

I've been mucking around on the command line with Ruby again of late, and one thing that tripped me up initially, but is now firmly on my list of things I Like About Programming is how Ruby handles loops.

With javascript, actionscript, php, it's pretty common to iterate through an array with a for loop something like this:
<pre><span style="font-family: Georgia; line-height: 19px; white-space: normal;">f</span>or (i =o; i = array.length; i ++ ) {</pre>
<pre><span style="white-space:pre">	</span>// call function foo() on array iteration 'i', with argument 'bar'</pre>
<pre><span style="white-space:pre">	</span>array[i].foo(bar)</pre>
<pre>}</pre>
This is doable in Ruby too, but the following is much more common:
<pre><span style="font-family: Georgia; line-height: 19px; white-space: normal;">a</span>rray do |i|</pre>
<pre><span style="white-space:pre">	</span>// call function 'foo' on array iteration 'i'<span style="white-space:pre">	</span></pre>
<pre><span style="white-space:pre">	</span> i.foo(bar)</pre>
<pre>end</pre>
You could argue that you lose some context inside the loop if it's a long enough method, but for quick loops like in this file renaming widget me and Chris Mear wrote for the Open Rights Group, the expressiveness is pretty impressive.

Here's the full code we used for renaming the 6000-odd files that Photoshop spat out for the ORG founding 1000 badges. Chris knocked this out in about 5 minutes, and I've now commented it to the point that it's parsable even when I'm hungover. 

 
<pre># this script iterates through about 6000 files that have been generated by Photoshop, </pre>
<pre># then renames them to fit naming conventions for a web app, as specified in a CSV file 'codes.csv'</pre>
<pre># The Ruby CSV module allows to iterate through csv file easily</pre>
<pre>require 'csv'</pre>
<pre># declare array literal to put desired filenames into</pre>
<pre>codes = []</pre>
<pre># take column two of each row in codes.csv, and put it into </pre>
<pre># the first column of each row of the recently declared codes array </pre>
<pre>CSV.open("codes.csv", 'r') do |row|</pre>
<pre>  codes[row[1].to_i] = row[0]</pre>
<pre>end</pre>
<pre># switch into the directory 'export'</pre>
<pre>Dir.chdir 'export'</pre>
<pre># bookmark current directory to return to later  </pre>
<pre>wd = Dir.getwd </pre>
<pre># glob is a function that returns an array of items matching the pattern given.</pre>
<pre># in this case it this returns pretty much every directory or file name everything</pre>
<pre># we could also substitute with Dir.entries('.')</pre>
<pre>('*') do |dirname|</pre>
<pre>  # Dir.chdir is the Ruby equivalent to 'cd dirname'</pre>
<pre>  Dir.chdir(dirname)</pre>
<pre>  # perform a search for all .png files, (all files ending with '.png'  )</pre>
<pre>  Dir.glob('*.png') do |filename|</pre>
<pre>    # read each filename, find the part of the filename that isn't the number (the '/\D/' part of the regular expression), </pre>
<pre>    # then strip it out, leaving just the number, making sure to convert this to an integer, not a string</pre>
<pre>    number = filename.gsub(/\D/, '').to_i</pre>
<pre>    # local variable 'code' exists inside this loop only</pre>
<pre>    code = codes[number]</pre>
<pre>    new_filename = "#{code}.png"</pre>
<pre>    puts "Renaming #{filename} to #{new_filename}."</pre>
<pre>    File.rename(filename, new_filename)</pre>
<pre>  end</pre>
<pre>  # switch back to the starting directory before looping through the    </pre>
<pre>  # next folder </pre>
<pre>  Dir.chdir(wd)</pre>
<pre>end</pre>

