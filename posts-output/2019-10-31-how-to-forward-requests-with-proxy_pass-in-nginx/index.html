<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Chris Adams Blog: How to forward requests with proxy_pass in nginx</title>
        
<meta name="keywords" content="">

<meta property="og:url" content="http://blog.chrisadams.me.uk/posts-output/2019-10-31-how-to-forward-requests-with-proxy_pass-in-nginx/" />
<meta property="og:title" content="How to forward requests with proxy_pass in nginx" />
<meta property="og:type" content="article" />

        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Oxygen:300,400,700|Inconsolata" rel="stylesheet">
        <link href="/css/normalize.css" rel="stylesheet" type="text/css" />
        <link href="/css/blog.css" rel="stylesheet" type="text/css" />
        <link href="/css/lotus-highlightjs.min.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <aside id="sidebar">
            <div id="logo">
                <a title="Chris Adams Blog" href="/">
                <div class="text desktop-and-tablet-only">Chris Adams Blog</div>
                <div class="text mobile-only">Chris Adams Blog</div>
                </a>
            </div>

            <nav id="sidebar-links">
                <nav id="menucont">
                    <input type="checkbox" id="menu-checkbox" class="menu-checkbox">
                    <label for="menu-checkbox" class="menutitle">
                        <svg class="icon icon-menu" aria-hidden="true"><use xlink:href="/img/icons.svg#icon-menu"></use></svg><span class="menu-text">Menu</span>
                    </label>
                    <ul class="menu">
                        <li ><a title="Home" href="/"><div class="menu-item-text">Home</div></a></li>
                        <li ><a title="Archives" href="/archives/"><div class="menu-item-text">Archives</div></a></li>
                        
                        
                        <li >
                            <a href="/pages-output/about/"><div class="menu-item-text">About</div></a>
                        </li>
                        
                        <!-- <li><a title="RSS" href="/feed.xml"><div class="menu-item-text">RSS</div></a></li> -->
                    </ul>
                </nav>

                <nav id="socialmedia">
                    <ul>
                        <li><a title="LinkedIn" href="https://www.linkedin.com/in/matthewdavidson1" rel="external"><svg class="icon icon-linkedin"><use xlink:href="/img/icons.svg#icon-linkedin"></use></svg></a></li>
                        <li><a title="GitHub" href="https://github.com/KingMob" rel="external"><svg class="icon icon-github-circled"><use xlink:href="/img/icons.svg#icon-github-circled"></use></svg></a></li>
                        <li><a title="RSS Feed" href="/feed.xml"><svg class="icon icon-rss-squared"><use xlink:href="/img/icons.svg#icon-rss-squared"></use></svg></a></li>
                    </ul>
                </nav>
            </nav>
        </aside>

        <article id="main">
            
<div id="post">
    <div class="post-header">
    <div id="post-meta">
        <h1>How to forward requests with proxy_pass in nginx</h1>
        <div class="byline">
            <span class="date">October 31, 2019</span>
            
            <span class="author">By: mrchrisadams</span>
            
        </div>
    </div>
</div>
<div>
    
    <!-- content below --><!-- wp:paragraph --><p>I've been doing some work of late with The Green Web Foundation, and recently we moved from using Gearman as a queue, to RabbitMQ instead.</p><!-- /wp:paragraph --><!-- wp:paragraph --><p>RabbitMQ has a management UI that makes it easier to tell what it's doing, and it also exposes this information at a specific port, (lets say 12345) in the form of a handy dashboard.</p><!-- /wp:paragraph --><!-- wp:paragraph --><p>You might want to make this easy to see remotely, and if you already use Nginx as a webserver for serving files on the same machine, one thing you can do is serve this dashboard using nginx, using a handy directive called <em>proxy_pass</em>, and setting up an <em>upstream</em> provider, to send requests to another service.</p><!-- /wp:paragraph --><!-- wp:paragraph --><p>Here's how it works.</p><!-- /wp:paragraph --><!-- wp:paragraph --><p><strong>First all, set up a server</strong></p><!-- /wp:paragraph --><!-- wp:syntaxhighlighter/code --><pre class="wp-block-syntaxhighlighter-code">server {
  # sample values
  listen 123.123.123.123:80;
  server_name dashboard.thegreenwebfoundation.org;
  # the directory to serve files from
  root  /var/www/dashboard.thegreenwebfoundation.org;


  location / {
        # try to serve file directly, fallback to index.php
        try_files $uri /index.html$is_args$args;
  }

}
</pre><!-- /wp:syntaxhighlighter/code --><!-- wp:paragraph --><p>Once you have a server, this should be serving files from the directory <code>/var/www/dashboard.thegreenwebfoundation.org</code>.</p><!-- /wp:paragraph --><!-- wp:paragraph --><p>This works for static files, but in the case of the RabbitMQ dashboard, we have the dashboard being served from a different port.</p><!-- /wp:paragraph --><!-- wp:paragraph --><p>One way to serve this content on a different port is to define it as an <em>upstream</em>, server, like so, so we can refer to it later:</p><!-- /wp:paragraph --><!-- wp:syntaxhighlighter/code --><pre class="wp-block-syntaxhighlighter-code">upstream rabbitmgmnt {
	server localhost:12345;
}</pre><!-- /wp:syntaxhighlighter/code --><!-- wp:paragraph --><p>Now we have defined a server listening on 12345, we need a way to send traffic along to this new upstream server. One way is to use the <code>location</code> directive like this - now, any requests sent to <code>dashboard.thegreenwebfoundation.org/rabbit</code> will not be sent along to the upstream rabbitmgnt server.</p><!-- /wp:paragraph --><!-- wp:syntaxhighlighter/code --><pre class="wp-block-syntaxhighlighter-code">location /rabbit/ {
        proxy_pass http://rabbitmgmnt/;
  }</pre><!-- /wp:syntaxhighlighter/code --><!-- wp:paragraph --><p><strong>Why is this useful?</strong></p><!-- /wp:paragraph --><!-- wp:paragraph --><p>This is handy as it saves you needing to set up a whole new virtual host.</p><!-- /wp:paragraph --><!-- wp:paragraph --><p>Note: I've abridged the code this example to keep the code easily readable, but you'd almost always serve this over HTTPS, and ideally, you'd try to reduce the possible IP addresses you've be able to access this endpoint over.</p><!-- /wp:paragraph --><!-- wp:paragraph --><p>This post is one for my future self, when I forget how to use nginx againâ€¦</p><!-- /wp:paragraph --><!-- wp:paragraph --><p><strong>Helpful links</strong></p><!-- /wp:paragraph --><!-- wp:paragraph --><p>RabbitMQ Management plugin - <a href="https://www.rabbitmq.com/management.html">https://www.rabbitmq.com/management.html</a></p><!-- /wp:paragraph --><!-- wp:paragraph --><p>Nginx proxy_pass info - <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass</a></p><!-- /wp:paragraph --><!-- wp:paragraph --><p>Nginx upstream servers - <a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#upstream">http://nginx.org/en/docs/http/ngx_http_upstream_module.html#upstream</a></p><!-- /wp:paragraph --><!-- wp:paragraph --><p></p><!-- /wp:paragraph -->
</div>

<br/>


    
    <div id="prev-next">
    
    <a class="prev" href="/posts-output/2019-11-08-two-things-i-wish-existed-and-would-want-to-make-if-had-lawyer-super-powers/"><svg class="icon icon-circle-left"><use xlink:href="/img/icons.svg#icon-circle-left"></use></svg><div class="nav-text">Two things I wish existed, and would want to make if had lawyer super powers</div></a>
    
    
    <a class="next" href="/posts-output/2019-09-22-fellowship-it-an-idea-to-get-over-the-last-hurdle-when-applying-for-funding/"><div class="nav-text"">Fellowship-it: an idea to get over the last hurdle when applying for funding</div><svg class="icon icon-circle-right"><use xlink:href="/img/icons.svg#icon-circle-right"></use></svg></a>
    
</div>

    

</div>

            <hr/>
            <div id="footercont">
                Copyright &copy; 2020 Chris Adams
                <br>Powered by <a href="http://cryogenweb.org">Cryogen</a>
                <br>Theme by <a href="http://github.com/KingMob">KingMob</a>
            </div>
        </article>

        <script src="/js/highlight.pack.js" type="text/javascript"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        
        
    </body>
</html>
