<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Chris Adams Blog: Poking around the Capistrano gem binary, </title>
        
<meta name="keywords" content="">

<meta name="description" content="I&#39;ve recently been trying to get an understanding of how Rubygems lets us &#39;require&#39; external code libraries by looking at a typical gem binary, because wasn&#39;t too clear to me how everything worked under the hood, and when I&#39;ve tried to modify existing gems, I&#39;ve been left scratching my head, generally unable to progress beyond having nice ideas.">

<meta property="og:description" content="I&#39;ve recently been trying to get an understanding of how Rubygems lets us &#39;require&#39; external code libraries by looking at a typical gem binary, because wasn&#39;t too clear to me how everything worked under the hood, and when I&#39;ve tried to modify existing gems, I&#39;ve been left scratching my head, generally unable to progress beyond having nice ideas.">

<meta property="og:url" content="http://blog.chrisadams.me.uk/posts-output/2010-05-04-poking-around-the-capistrano-gem-binary/" />
<meta property="og:title" content="Poking around the Capistrano gem binary, " />
<meta property="og:type" content="article" />

        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Oxygen:300,400,700|Inconsolata" rel="stylesheet">
        <link href="/css/normalize.css" rel="stylesheet" type="text/css" />
        <link href="/css/blog.css" rel="stylesheet" type="text/css" />
        <link href="/css/lotus-highlightjs.min.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <aside id="sidebar">
            <div id="logo">
                <a title="Chris Adams Blog" href="/">
                <div class="text desktop-and-tablet-only">Chris Adams Blog</div>
                <div class="text mobile-only">Chris Adams Blog</div>
                </a>
            </div>

            <nav id="sidebar-links">
                <nav id="menucont">
                    <input type="checkbox" id="menu-checkbox" class="menu-checkbox">
                    <label for="menu-checkbox" class="menutitle">
                        <svg class="icon icon-menu" aria-hidden="true"><use xlink:href="/img/icons.svg#icon-menu"></use></svg><span class="menu-text">Menu</span>
                    </label>
                    <ul class="menu">
                        <li ><a title="Home" href="/"><div class="menu-item-text">Home</div></a></li>
                        <li ><a title="Archives" href="/archives/"><div class="menu-item-text">Archives</div></a></li>
                        
                        
                        <li >
                            <a href="/pages-output/about/"><div class="menu-item-text">About</div></a>
                        </li>
                        
                        <!-- <li><a title="RSS" href="/feed.xml"><div class="menu-item-text">RSS</div></a></li> -->
                    </ul>
                </nav>

                <nav id="socialmedia">
                    <ul>
                        <li><a title="LinkedIn" href="https://www.linkedin.com/in/matthewdavidson1" rel="external"><svg class="icon icon-linkedin"><use xlink:href="/img/icons.svg#icon-linkedin"></use></svg></a></li>
                        <li><a title="GitHub" href="https://github.com/KingMob" rel="external"><svg class="icon icon-github-circled"><use xlink:href="/img/icons.svg#icon-github-circled"></use></svg></a></li>
                        <li><a title="RSS Feed" href="/feed.xml"><svg class="icon icon-rss-squared"><use xlink:href="/img/icons.svg#icon-rss-squared"></use></svg></a></li>
                    </ul>
                </nav>
            </nav>
        </aside>

        <article id="main">
            
<div id="post">
    <div class="post-header">
    <div id="post-meta">
        <h1>Poking around the Capistrano gem binary, </h1>
        <div class="byline">
            <span class="date">May 4, 2010</span>
            
            <span class="author">By: admin</span>
            
        </div>
    </div>
</div>
<div>
    
    <!-- content below --><p>I've recently been trying to get an understanding of how Rubygems lets us 'require' external code libraries by looking at a typical gem binary, because wasn't too clear to me how everything worked under the hood, and when I've tried to modify existing gems, I've been left scratching my head, generally unable to progress beyond having nice ideas.</p><p>I've written commented the living daylights out the 'cap' command on my system, to help me understand how it works:</p><pre lang="ruby">
#!/Users/chrisadams/.rvm/rubies/ruby-1.8.7-p249/bin/ruby
#
# This file was generated by RubyGems.
#
# The application 'capistrano' is installed as part of a gem, and
# this file is here to facilitate running it.
#
require 'rubygems'
version = "&gt;= 0"
if ARGV.first =~ /^_(.*)_$/ and Gem::Version.correct? $1 then
version = $1
ARGV.shift
end
gem 'capistrano', version
load Gem.bin_path('capistrano', 'cap', version)</pre>

<p>Lets look at the various parts in more detail, shall we?</p><pre lang="ruby">
require 'rubygems'
</pre><p>We use this to make previously downloaded gems accessible by name, instead of having to provide the full path to each ruby file.</p><pre lang="ruby">
version = "&gt;= 0"
</pre><p>Here we're listing the minumum version needed for this the capistrano gem to work</p><pre lang="ruby">
if ARGV.first =~ /^_(.*)_$/ and Gem::Version.correct? $1 then
  version = $1
  ARGV.shift
end
</pre><p>This checks the for any version numbers passed in, then removes it from the array that the 'cap' command would normally proces when working out what you want to do.</p><pre lang="ruby">
gem 'capistrano', version
</pre><p>The 'gem' method is like using a 'require statement for a rubygem', but lets us be version specific, in case changes to a codebase on a version bump break functionality. Capistrano's API has changed a few times, and great chunks of the DSL it uses have been deprecated, so this check is worthwhile:</p><pre lang="ruby">
load Gem.bin_path('capistrano', 'cap', version)
</pre><p>This is the path that really gets the ball rolling. The 'bin_path' method executes a binary in the gem named with the first parameter (in this case, capistrano). The second parameter lets us specify which binary should be used in the gem, in case the name of the binary, 'cap' isn't the same as the name of the code library , 'capistrano'. This lets us store multiple binaries on the rubygem without too much fear of clashes in the namespace.</p><p>This should have helped demystify each line in a common ruby based binary command - in the next post, I'll touch on how Capistrano can be called from the command line, or inside a script, by instantiating config objects that control how the program is run when you're not directly calling it from a terminal.</p>
</div>

<br/>


    
    <div id="prev-next">
    
    <a class="prev" href="/posts-output/2010-05-04-making-arrays-with-ruby-without-those-pesky-commas/"><svg class="icon icon-circle-left"><use xlink:href="/img/icons.svg#icon-circle-left"></use></svg><div class="nav-text">Making arrays with ruby, without those pesky commas</div></a>
    
    
    <a class="next" href="/posts-output/2010-05-01-painful-times-ahead/"><div class="nav-text"">Painful times ahead</div><svg class="icon icon-circle-right"><use xlink:href="/img/icons.svg#icon-circle-right"></use></svg></a>
    
</div>

    

</div>

            <hr/>
            <div id="footercont">
                Copyright &copy; 2020 Chris Adams
                <br>Powered by <a href="http://cryogenweb.org">Cryogen</a>
                <br>Theme by <a href="http://github.com/KingMob">KingMob</a>
            </div>
        </article>

        <script src="/js/highlight.pack.js" type="text/javascript"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        
        
    </body>
</html>
