<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Chris Adams Blog: Notes on Chef - Understanding Resources and Providers</title>
        
<meta name="keywords" content="">

<meta name="description" content="Title: Understanding resources and providers in Chef
Date: 2010-05-07 08:36:45">

<meta property="og:description" content="Title: Understanding resources and providers in Chef
Date: 2010-05-07 08:36:45">

<meta property="og:url" content="http://blog.chrisadams.me.uk/posts-output/2010-05-07-notes-on-chef-understanding-resources-and-providers/" />
<meta property="og:title" content="Notes on Chef - Understanding Resources and Providers" />
<meta property="og:type" content="article" />

        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Oxygen:300,400,700|Inconsolata" rel="stylesheet">
        <link href="/css/normalize.css" rel="stylesheet" type="text/css" />
        <link href="/css/blog.css" rel="stylesheet" type="text/css" />
        <link href="/css/lotus-highlightjs.min.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <aside id="sidebar">
            <div id="logo">
                <a title="Chris Adams Blog" href="/">
                <div class="text desktop-and-tablet-only">Chris Adams Blog</div>
                <div class="text mobile-only">Chris Adams Blog</div>
                </a>
            </div>

            <nav id="sidebar-links">
                <nav id="menucont">
                    <input type="checkbox" id="menu-checkbox" class="menu-checkbox">
                    <label for="menu-checkbox" class="menutitle">
                        <svg class="icon icon-menu" aria-hidden="true"><use xlink:href="/img/icons.svg#icon-menu"></use></svg><span class="menu-text">Menu</span>
                    </label>
                    <ul class="menu">
                        <li ><a title="Home" href="/"><div class="menu-item-text">Home</div></a></li>
                        <li ><a title="Archives" href="/archives/"><div class="menu-item-text">Archives</div></a></li>
                        
                        
                        <li >
                            <a href="/pages-output/about/"><div class="menu-item-text">About</div></a>
                        </li>
                        
                        <!-- <li><a title="RSS" href="/feed.xml"><div class="menu-item-text">RSS</div></a></li> -->
                    </ul>
                </nav>

                <nav id="socialmedia">
                    <ul>
                        <li><a title="LinkedIn" href="https://www.linkedin.com/in/matthewdavidson1" rel="external"><svg class="icon icon-linkedin"><use xlink:href="/img/icons.svg#icon-linkedin"></use></svg></a></li>
                        <li><a title="GitHub" href="https://github.com/KingMob" rel="external"><svg class="icon icon-github-circled"><use xlink:href="/img/icons.svg#icon-github-circled"></use></svg></a></li>
                        <li><a title="RSS Feed" href="/feed.xml"><svg class="icon icon-rss-squared"><use xlink:href="/img/icons.svg#icon-rss-squared"></use></svg></a></li>
                    </ul>
                </nav>
            </nav>
        </aside>

        <article id="main">
            
<div id="post">
    <div class="post-header">
    <div id="post-meta">
        <h1>Notes on Chef - Understanding Resources and Providers</h1>
        <div class="byline">
            <span class="date">May 7, 2010</span>
            
            <span class="author">By: admin</span>
            
        </div>
    </div>
</div>
<div>
    
    <!-- content below --><p>Title: Understanding resources and providers in Chef
Date: 2010-05-07 08:36:45</p><p>Chef is a pretty huge system, and one area that I didn't quite follow before was how recipes described in cookbooks were actually executed on the client machines when they were run. One of the key ideas with chef is that when you're writing recipes, you're effectively decoupling the results you'd want from an action, from the implementation, so you end up with a cross platform way to perform a given task.</p><h1 id="resources-and-providers">Resources and Providers</h1><p>You do this primarily in chef by writing Resources, which are high level ways to describe an action, like install a software <a href="http://wiki.opscode.com/display/chef/Resources#Resources-Package" title="Resources - Chef - Opscode Open Source Wiki">package</a>, or edit a <a href="http://wiki.opscode.com/display/chef/Resources#Resources-Group" title="Resources - Chef - Opscode Open Source Wiki">group</a> or <a href="http://wiki.opscode.com/display/chef/Resources#Resources-User" title="Resources - Chef - Opscode Open Source Wiki">user</a>, then writing a Provider, which describes how you might actually implement this action on a given platform, or server setup.</p><p>For example on the <a href="http://wiki.opscode.com/display/chef/Resources#Resources-Group" title="Resources - Chef - Opscode Open Source Wiki">group</a> resource, when you're on a Linux system, you'll use a provider like <code>Chef::Provider::User::Useradd</code> by default, which is effectively a wrapper around a compiled binary like <code>useradd</code>, but if you're running Chef a Mac OS box, the default provider would be <code>Chef::Provider::User::Dscl</code>, which is essentially the same kind of wrapper around the <code>dscl</code> command.</p><p>It's this abstraction layer that decouples the action, from the implementation, and without understanding this, you won't get too far when writing cookbooks.</p><h1 id="an-example---the-script-resource">An example - the Script Resource</h1><p>A good example of resource and providers would be the Script resource, because it shows how the code you might write when using a resource ends up looking like a cross between bash and ruby.</p><pre lang="ruby">
    script "install_something" do
      interpreter "bash"
      user "root"
      cwd "/tmp"
      code <_-EOH install="install" tarball.tar.gz="tarball.tar.gz" make="make" tar="tar" pre="pre" _.="_." http:_="http:_" _="_" cd="cd" configure="configure" eoh="eoh" tarball="tarball" _-zxf="_-zxf" end="end" www.example.com="www.example.com" wget="wget"><p>In the snippet above, we're doing a common task - downloading a tarfile, then doing the <code>configure</code>, <code>make</code>, <code>make install</code> dance to compile it, but in the the first few lines, we're telling the resource to use the bash provider, and to switch to the root user first, before running the command by calling actions and attributes that the Resource has made available to us. It pays to check the docs on the opscode page if you see a command that you don't recognise when looking at recipes, as they're often described in the <code>actions</code> or <code>attributes</code> section.</p><p>One trick peculiar to the Script resource, is this shortcut to run the same string of commands without needing to explicitly set the interpreter in the block:</p><pre lang="ruby">
    bash "install_something" do
    user "root"
      cwd "/tmp"
      code <_-EOH install="install" tarball.tar.gz="tarball.tar.gz" make="make" tar="tar" pre="pre" _.="_." http:_="http:_" _="_" cd="cd" configure="configure" eoh="eoh" tarball="tarball" _-zxf="_-zxf" end="end" www.example.com="www.example.com" wget="wget"><p>As mentioned before, you have more than one Provider for a given resource. In this case, we currently have 5 different providers, that correspond to the main shells or interpreters for running scripts, listed below:</p><pre lang="ruby">
    Chef::Resource::Script::Bash   bash
    Chef::Resource::Script::Csh    csh
    Chef::Resource::Script::Perl   perl
    Chef::Resource::Script::Python python
    Chef::Resource::Script::Ruby   ruby
</pre><p>This post should give a some high level insight into how Resources and Providers work, but as ever, if you're working with Chef, and their wiki isn't in your bookmarks You're Doing it Wrong - check the relevant pages, and with some luck this powerful feature of chef should become a bit less cryptic.</p></_-EOH></pre></_-EOH></pre>
</div>

<br/>


    
    <div id="prev-next">
    
    <a class="prev" href="/posts-output/2010-05-08-slideshares-ui-guys-are-really-rather-good/"><svg class="icon icon-circle-left"><use xlink:href="/img/icons.svg#icon-circle-left"></use></svg><div class="nav-text">Slideshare&#39;s UI guys are really rather good.</div></a>
    
    
    <a class="next" href="/posts-output/2010-05-05-going-beyond-typing-cap-deploy/"><div class="nav-text"">Going beyond typing cap deploy</div><svg class="icon icon-circle-right"><use xlink:href="/img/icons.svg#icon-circle-right"></use></svg></a>
    
</div>

    

</div>

            <hr/>
            <div id="footercont">
                Copyright &copy; 2020 Chris Adams
                <br>Powered by <a href="http://cryogenweb.org">Cryogen</a>
                <br>Theme by <a href="http://github.com/KingMob">KingMob</a>
            </div>
        </article>

        <script src="/js/highlight.pack.js" type="text/javascript"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        
        
    </body>
</html>
