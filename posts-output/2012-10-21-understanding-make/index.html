<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Chris Adams Blog: Understanding `make`</title>
        
<meta name="keywords" content="">

<meta name="description" content="I&#39;m working with node more as I develop a few projects in my spare time, and I&#39;ve just come across the node community&#39;s habit of using Makefiles to automate tasks in their project.">

<meta property="og:description" content="I&#39;m working with node more as I develop a few projects in my spare time, and I&#39;ve just come across the node community&#39;s habit of using Makefiles to automate tasks in their project.">

<meta property="og:url" content="http://blog.chrisadams.me.uk/posts-output/2012-10-21-understanding-make/" />
<meta property="og:title" content="Understanding `make`" />
<meta property="og:type" content="article" />

        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Oxygen:300,400,700|Inconsolata" rel="stylesheet">
        <link href="/css/normalize.css" rel="stylesheet" type="text/css" />
        <link href="/css/blog.css" rel="stylesheet" type="text/css" />
        <link href="/css/lotus-highlightjs.min.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <aside id="sidebar">
            <div id="logo">
                <a title="Chris Adams Blog" href="/">
                <div class="text desktop-and-tablet-only">Chris Adams Blog</div>
                <div class="text mobile-only">Chris Adams Blog</div>
                </a>
            </div>

            <nav id="sidebar-links">
                <nav id="menucont">
                    <input type="checkbox" id="menu-checkbox" class="menu-checkbox">
                    <label for="menu-checkbox" class="menutitle">
                        <svg class="icon icon-menu" aria-hidden="true"><use xlink:href="/img/icons.svg#icon-menu"></use></svg><span class="menu-text">Menu</span>
                    </label>
                    <ul class="menu">
                        <li ><a title="Home" href="/"><div class="menu-item-text">Home</div></a></li>
                        <li ><a title="Archives" href="/archives/"><div class="menu-item-text">Archives</div></a></li>
                        
                        
                        <li >
                            <a href="/pages-output/about/"><div class="menu-item-text">About</div></a>
                        </li>
                        
                        <!-- <li><a title="RSS" href="/feed.xml"><div class="menu-item-text">RSS</div></a></li> -->
                    </ul>
                </nav>

                <nav id="socialmedia">
                    <ul>
                        <li><a title="LinkedIn" href="https://www.linkedin.com/in/matthewdavidson1" rel="external"><svg class="icon icon-linkedin"><use xlink:href="/img/icons.svg#icon-linkedin"></use></svg></a></li>
                        <li><a title="GitHub" href="https://github.com/KingMob" rel="external"><svg class="icon icon-github-circled"><use xlink:href="/img/icons.svg#icon-github-circled"></use></svg></a></li>
                        <li><a title="RSS Feed" href="/feed.xml"><svg class="icon icon-rss-squared"><use xlink:href="/img/icons.svg#icon-rss-squared"></use></svg></a></li>
                    </ul>
                </nav>
            </nav>
        </aside>

        <article id="main">
            
<div id="post">
    <div class="post-header">
    <div id="post-meta">
        <h1>Understanding `make`</h1>
        <div class="byline">
            <span class="date">October 21, 2012</span>
            
            <span class="author">By: admin</span>
            
        </div>
    </div>
</div>
<div>
    
    <!-- content below --><p>I'm working with node more as I develop a few projects in my spare time, and I've just come across the node community's habit of using <code>Makefiles</code> to automate tasks in their project.</p><p>I've played with Python, PHP, and Ruby over the last few years, but in that time I've barely used MakeFiles at all, so after a fee initial hiccups, I was pleased to find them pretty straightforward to work with.</p><p>Here's a trivial makefile I'm using on a project:</p><pre><code>test:	
	./node_modules/.bin/mocha \
	--reporter dot

test-watch:	
	./node_modules/.bin/mocha \
	--reporter list \
	--watch

.PHONY: test
</code></pre><p>With this, I can type <code>make</code> on the project root. and it'll run the tests on the project, without me needing to think about what kinds of options I need to set beforehand to make sure I'm using the right test tools, or getting the right output to understand what the test results are telling me and so on.</p><p>In the case above, I've got a basic make test, and I've also got a <code>test-watch</code> task defined here, to give me constant feedback when making changes to the codebase to see if I've broken anything. I've also changed the output to be a bit more readable, for when I'm looking over it.</p><p>In both cases, I've just defined the task name, then on the following lines, written the shell commands to execute.</p><h3 id="a-few-gotchas">A few gotchas</h3><p>Well, it <em>should</em> be that easy, right?</p><h4 id="a-strange-fetish-of-tabs">A strange fetish of tabs</h4><p>When I first copied and pasted a makefile to try running it, I had this cryptic response though -</p><pre><code>Makefile:2: *** missing separator.  Stop.

"Makefile", line 2: Need an operator
Fatal errors encountered -- cannot continue
</code></pre><p>The trick here, is to make sure after defining the task on online, you HAVE to use tabs to indent the subsequent shell commands, or <code>make</code> throws a fit like above. Life is too short to work out why, so it's best to just roll your eyes, accept it, then move on.</p><h4 id="how-does-make-know-what-to-call-when-you-type-make-and-what-is-this-phony-japery">How does <code>make</code> know what to call when you type <code>make</code> and what is this PHONY japery?</h4><p>This threw me initially when I was trying to understand the syntax, but I think I've got a handle on it now.</p><p>By default, if you type <code>make</code>, it will look for the first task it can run in the <code>Makefile</code>, in this case <code>test</code>. However, because make was originally a build tool for managing dependencies when building projects, <code>make</code> will only run if there isn't a file or directory with the same name as it in the current working directory, because it assumes you want to be building a file and output something called 'test'.</p><p>If there is a something there in your propect with that name, then you'll get a response like so:</p><pre><code>12:23pm $ make
  make: `test' is up to date.
</code></pre><p>What the <code>PHONY</code> line does, is tell <code>make</code> not to care if there are directories or files called <code>test</code> in the project structure, and just to run the task anyway.</p><p>Without the <code>PHONY</code> line, your <code>test</code> task will never run if there's a directory called <code>test</code> lying around.</p><p>And there you have it. You should know enough now to write your own make tasks. Off you go then.</p><h3 id="helpful-links">Helpful links</h3><p><a href="http://makepp.sourceforge.net/1.18/t_phony.html">This piece here helped me get my head round phony</a>, and <a href="http://www.cs.usask.ca/staff/oster/makefiles.html">this one here</a> gave me a handy background too. Finally, the <a href="http://visionmedia.github.com/mocha/">mocha testing library</a> was the reason I decided to try to learn this in the first place, and an nice example of it being used in a javascript project.</p>
</div>

<br/>


    
    <div id="prev-next">
    
    <a class="prev" href="/posts-output/2012-10-27-transparency-is-better-when-its-frequent/"><svg class="icon icon-circle-left"><use xlink:href="/img/icons.svg#icon-circle-left"></use></svg><div class="nav-text">Transparency is better when it&#39;s frequent</div></a>
    
    
    <a class="next" href="/posts-output/2012-10-07-98-of-every-dollar-made-by-spotify-goes-on-paying-music-royalties/"><div class="nav-text"">98% of every dollar made by spotify goes on paying music royalties</div><svg class="icon icon-circle-right"><use xlink:href="/img/icons.svg#icon-circle-right"></use></svg></a>
    
</div>

    

</div>

            <hr/>
            <div id="footercont">
                Copyright &copy; 2020 Chris Adams
                <br>Powered by <a href="http://cryogenweb.org">Cryogen</a>
                <br>Theme by <a href="http://github.com/KingMob">KingMob</a>
            </div>
        </article>

        <script src="/js/highlight.pack.js" type="text/javascript"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        
        
    </body>
</html>
